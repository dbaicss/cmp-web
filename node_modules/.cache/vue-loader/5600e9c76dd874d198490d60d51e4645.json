{"remainingRequest":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xuyangbing/Desktop/devopsManage/client/src/views/WebTerminal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xuyangbing/Desktop/devopsManage/client/src/views/WebTerminal.vue","mtime":1553765621000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n\nimport { Terminal } from 'xterm'\nimport 'xterm/dist/xterm.css'\nimport * as fit from 'xterm/lib/addons/fit/fit'\nTerminal.applyAddon(fit)\n\nexport default {\n  name: 'Terminal',\n  data() {\n    return {\n      term: null,\n      websock: null,\n      timer: null\n    }\n  },\n  computed: {\n    terminalId() {\n      console.log(`terminal_${this._uid}`)\n      return `terminal_${this._uid}`\n    },\n    cluster() {\n      return ''\n    },\n    namespace() {\n      return localStorage.getItem('namespace')\n    },\n    pod() {\n      return localStorage.getItem('name')\n    },\n    container() {\n      return ''\n    },\n    wsUrl() {\n      const host = window.location.host\n      return `${host}`\n    }\n  },\n  mounted() {\n    window.addEventListener('resize', this.handleResize)\n    this.initWebSocket()\n    const _self = this\n    this.term = new Terminal()\n\n    this.term.on('data', function(input) {\n      const sendData = JSON.stringify({type: \"input\", input: input})\n      _self.websocketsend(sendData)\n    })\n\n    this.term.open(document.getElementById(this.terminalId))\n\n    this.term.on('resize', function() {\n      //this.term.fit()\n      //const re = this.get_term_size()\n      const sendData = JSON.stringify({type: \"resize\", rows: 400, cols: 400})\n      _self.websocketsend(sendData)\n    })\n  },\n  beforeDestroy() {\n    if (this.term) {\n      this.term.destroy()\n    }\n    window.removeEventListener('resize', this.handleResize) // 移除获取高度事件\n  },\n  methods: {\n    initWebSocket() { // 初始化weosocket\n      const wsuri = `ws://localhost:8000/ssh?podNs=${this.namespace}&podName=${this.pod}&containerName=${this.container}`\n      //const wsuri = `ws://${this.wsUrl}/ssh?podNs=${this.namespace}&podName=${this.pod}&containerName=${this.container}`\n      this.websock = new WebSocket(wsuri)\n      this.websock.onmessage = this.websocketonmessage\n      this.websock.onopen = this.websocketonopen\n      this.websock.onerror = this.websocketonerror\n      this.websock.onclose = this.websocketclose\n    },\n    websocketonopen() { // 连接建立之后执行send方法发送数据\n      console.log('ws connected')\n    },\n    websocketonerror() { // 连接建立失败重连\n      console.log('连接出错')\n      this.term.write('连接出错\\r\\n')\n      // this.initWebSocket()\n    },\n    websocketonmessage(e) { // 数据接收\n      //const redata = JSON.parse(e.data)\n      const redata = e.data\n      this.term.write(redata)\n    },\n    websocketsend(Data) { // 数据发送\n      if (this.websock.readyState === 1) {\n        this.websock.send(Data)\n      }\n    },\n    websocketclose(e) { // 关闭\n      console.log('断开连接', e)\n      this.term.write('连接已断开\\r\\n')\n    },\n    get_term_size() {\n      var initWidth = 9\n      var initHeight = 17\n\n      var windowsWidth = document.body.clientWidth\n      var windowsHeight = document.documentElement.clientHeight\n      return {\n        cols: Math.floor(windowsWidth / initWidth),\n        rows: Math.floor(windowsHeight / initHeight)\n      }\n    },\n    handleResize() {\n      if (this.timer) {\n        clearTimeout(this.timer)\n        this.timer = null\n      }\n      this.timer = setTimeout(() => {\n        this.setTermSize()\n      }, 2000)\n    },\n    setTermSize() {\n      const { cols, rows } = this.get_term_size()\n      this.term.resize(cols, rows)\n      this.websock.send(JSON.stringify({type: \"resize\", rows: this.term.rows, cols: this.term.cols}))\n    }\n  }\n}\n",{"version":3,"sources":["WebTerminal.vue"],"names":[],"mappings":";;;;;;;AAOA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"WebTerminal.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <div :id=\"terminalId\"/>\n  </div>\n</template>\n\n<script>\nimport { Terminal } from 'xterm'\nimport 'xterm/dist/xterm.css'\nimport * as fit from 'xterm/lib/addons/fit/fit'\nTerminal.applyAddon(fit)\n\nexport default {\n  name: 'Terminal',\n  data() {\n    return {\n      term: null,\n      websock: null,\n      timer: null\n    }\n  },\n  computed: {\n    terminalId() {\n      console.log(`terminal_${this._uid}`)\n      return `terminal_${this._uid}`\n    },\n    cluster() {\n      return ''\n    },\n    namespace() {\n      return localStorage.getItem('namespace')\n    },\n    pod() {\n      return localStorage.getItem('name')\n    },\n    container() {\n      return ''\n    },\n    wsUrl() {\n      const host = window.location.host\n      return `${host}`\n    }\n  },\n  mounted() {\n    window.addEventListener('resize', this.handleResize)\n    this.initWebSocket()\n    const _self = this\n    this.term = new Terminal()\n\n    this.term.on('data', function(input) {\n      const sendData = JSON.stringify({type: \"input\", input: input})\n      _self.websocketsend(sendData)\n    })\n\n    this.term.open(document.getElementById(this.terminalId))\n\n    this.term.on('resize', function() {\n      //this.term.fit()\n      //const re = this.get_term_size()\n      const sendData = JSON.stringify({type: \"resize\", rows: 400, cols: 400})\n      _self.websocketsend(sendData)\n    })\n  },\n  beforeDestroy() {\n    if (this.term) {\n      this.term.destroy()\n    }\n    window.removeEventListener('resize', this.handleResize) // 移除获取高度事件\n  },\n  methods: {\n    initWebSocket() { // 初始化weosocket\n      const wsuri = `ws://localhost:8000/ssh?podNs=${this.namespace}&podName=${this.pod}&containerName=${this.container}`\n      //const wsuri = `ws://${this.wsUrl}/ssh?podNs=${this.namespace}&podName=${this.pod}&containerName=${this.container}`\n      this.websock = new WebSocket(wsuri)\n      this.websock.onmessage = this.websocketonmessage\n      this.websock.onopen = this.websocketonopen\n      this.websock.onerror = this.websocketonerror\n      this.websock.onclose = this.websocketclose\n    },\n    websocketonopen() { // 连接建立之后执行send方法发送数据\n      console.log('ws connected')\n    },\n    websocketonerror() { // 连接建立失败重连\n      console.log('连接出错')\n      this.term.write('连接出错\\r\\n')\n      // this.initWebSocket()\n    },\n    websocketonmessage(e) { // 数据接收\n      //const redata = JSON.parse(e.data)\n      const redata = e.data\n      this.term.write(redata)\n    },\n    websocketsend(Data) { // 数据发送\n      if (this.websock.readyState === 1) {\n        this.websock.send(Data)\n      }\n    },\n    websocketclose(e) { // 关闭\n      console.log('断开连接', e)\n      this.term.write('连接已断开\\r\\n')\n    },\n    get_term_size() {\n      var initWidth = 9\n      var initHeight = 17\n\n      var windowsWidth = document.body.clientWidth\n      var windowsHeight = document.documentElement.clientHeight\n      return {\n        cols: Math.floor(windowsWidth / initWidth),\n        rows: Math.floor(windowsHeight / initHeight)\n      }\n    },\n    handleResize() {\n      if (this.timer) {\n        clearTimeout(this.timer)\n        this.timer = null\n      }\n      this.timer = setTimeout(() => {\n        this.setTermSize()\n      }, 2000)\n    },\n    setTermSize() {\n      const { cols, rows } = this.get_term_size()\n      this.term.resize(cols, rows)\n      this.websock.send(JSON.stringify({type: \"resize\", rows: this.term.rows, cols: this.term.cols}))\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}
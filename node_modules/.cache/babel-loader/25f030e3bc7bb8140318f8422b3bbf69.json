{"remainingRequest":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/babel-loader/lib/index.js!/Users/xuyangbing/Desktop/devopsManage/client/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/xuyangbing/Desktop/devopsManage/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xuyangbing/Desktop/devopsManage/client/src/views/Ws.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xuyangbing/Desktop/devopsManage/client/src/views/Ws.vue","mtime":1553068116000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xuyangbing/Desktop/devopsManage/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\nimport { Terminal } from 'xterm';\nimport 'xterm/dist/xterm.css';\nimport * as fit from 'xterm/lib/addons/fit/fit';\nTerminal.applyAddon(fit); // 这俩插件不知道干嘛的, 用总比不用好\n//Terminal.applyAddon(winptyCompat)\n//Terminal.applyAddon(webLinks)\n\nexport default {\n  name: \"pod\",\n  data: function data() {\n    return {\n      term: null,\n      websock: null,\n      timer: null\n    };\n  },\n  computed: {\n    terminalId: function terminalId() {\n      return \"terminal_\".concat(this._uid);\n    },\n    namespace: function namespace() {\n      return localStorage.getItem('namespace');\n    },\n    pod: function pod() {\n      return localStorage.getItem('pod');\n    },\n    wsUrl: function wsUrl() {\n      //const protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://'\n      var host = window.location.host;\n      return \"\".concat(host);\n    }\n  },\n  mounted: function mounted() {\n    window.addEventListener('resize', this.handleResize);\n    this.initWebSocket();\n\n    var _self = this;\n\n    this.term = new Terminal();\n    this.term.on('data', function (data) {\n      var sendData = JSON.stringify({\n        op: 0,\n        stdin: data\n      });\n\n      _self.websocketsend(sendData);\n    });\n    this.term.open(document.getElementById(this.terminalId));\n    this.term.on('resize', function (size) {});\n\n    var _this$get_term_size = this.get_term_size(),\n        cols = _this$get_term_size.cols,\n        rows = _this$get_term_size.rows;\n\n    this.term.resize(cols, rows);\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.term) {\n      this.term.destroy();\n    }\n\n    window.removeEventListener('resize', this.handleResize); // 移除获取高度事件\n  },\n  methods: {\n    initsocket: function initsocket() {\n      var wsUri = \"ws://\".concat(this.wsUrl, \"/api/ws?\\\" + \\\"namespace=\\\" + \").concat(this.namespace, \" + \\\"&pod=\\\" + \").concat(this.pod);\n      this.websock = new WebSocket(wsUri);\n      this.websock.onmessage = this.websocketonmessage;\n      this.websock.onopen = this.websocketonopen;\n      this.websock.onerror = this.websocketonerror;\n      this.websock.onclose = this.websocketclose;\n    },\n    websocketonopen: function websocketonopen() {// 连接建立之后执行send方法发送数据\n    },\n    websocketonmessage: function websocketonmessage(e) {\n      // 数据接收\n      this.term.write(e.data);\n    },\n    websocketclose: function websocketclose(e) {\n      // 关闭\n      console.log('断开连接', e);\n      this.socket.close();\n    },\n    websocketonerror: function websocketonerror() {\n      // 连接建立失败重连\n      this.term.write('连接出错\\r\\n'); // this.initWebSocket()\n    },\n    resize: function resize() {\n      this.term.fit();\n      this.socket.send('{\"cols\":' + term.cols + ',\"rows\":' + term.rows + '}');\n    },\n    get_term_size: function get_term_size() {\n      var initWidth = 9;\n      var initHeight = 17;\n      var windowsWidth = document.body.clientWidth;\n      var windowsHeight = document.documentElement.clientHeight;\n      return {\n        cols: Math.floor(windowsWidth / initWidth),\n        rows: Math.floor(windowsHeight / initHeight)\n      };\n    },\n    handleResize: function handleResize() {\n      var _this = this;\n\n      if (this.timer) {\n        clearTimeout(this.timer);\n        this.timer = null;\n      }\n\n      this.timer = setTimeout(function () {\n        _this.setTermSize();\n      }, 2000);\n    },\n    setTermSize: function setTermSize() {\n      var _this$get_term_size2 = this.get_term_size(),\n          cols = _this$get_term_size2.cols,\n          rows = _this$get_term_size2.rows;\n\n      this.term.resize(cols, rows);\n      this.websock.send(this.get_term_size());\n    }\n  }\n};",{"version":3,"sources":["Ws.vue"],"names":[],"mappings":";;;;;;;AAQA,SAAA,QAAA,QAAA,OAAA;AACA,OAAA,sBAAA;AACA,OAAA,KAAA,GAAA,MAAA,0BAAA;AACA,QAAA,CAAA,UAAA,CAAA,GAAA,E,CACA;AACA;AACA;;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,KADA;AAEA,EAAA,IAFA,kBAEA;AACA,WAAA;AACA,MAAA,IAAA,EAAA,IADA;AAEA,MAAA,OAAA,EAAA,IAFA;AAGA,MAAA,KAAA,EAAA;AAHA,KAAA;AAKA,GARA;AASA,EAAA,QAAA,EAAA;AACA,IAAA,UADA,wBACA;AACA,gCAAA,KAAA,IAAA;AACA,KAHA;AAIA,IAAA,SAJA,uBAIA;AACA,aAAA,YAAA,CAAA,OAAA,CAAA,WAAA,CAAA;AACA,KANA;AAOA,IAAA,GAPA,iBAOA;AACA,aAAA,YAAA,CAAA,OAAA,CAAA,KAAA,CAAA;AACA,KATA;AAUA,IAAA,KAVA,mBAUA;AACA;AACA,UAAA,IAAA,GAAA,MAAA,CAAA,QAAA,CAAA,IAAA;AACA,uBAAA,IAAA;AACA;AAdA,GATA;AAyBA,EAAA,OAzBA,qBAyBA;AACA,IAAA,MAAA,CAAA,gBAAA,CAAA,QAAA,EAAA,KAAA,YAAA;AACA,SAAA,aAAA;;AACA,QAAA,KAAA,GAAA,IAAA;;AACA,SAAA,IAAA,GAAA,IAAA,QAAA,EAAA;AAEA,SAAA,IAAA,CAAA,EAAA,CAAA,MAAA,EAAA,UAAA,IAAA,EAAA;AACA,UAAA,QAAA,GAAA,IAAA,CAAA,SAAA,CAAA;AAAA,QAAA,EAAA,EAAA,CAAA;AAAA,QAAA,KAAA,EAAA;AAAA,OAAA,CAAA;;AACA,MAAA,KAAA,CAAA,aAAA,CAAA,QAAA;AACA,KAHA;AAKA,SAAA,IAAA,CAAA,IAAA,CAAA,QAAA,CAAA,cAAA,CAAA,KAAA,UAAA,CAAA;AAEA,SAAA,IAAA,CAAA,EAAA,CAAA,QAAA,EAAA,UAAA,IAAA,EAAA,CACA,CADA;;AAbA,8BAeA,KAAA,aAAA,EAfA;AAAA,QAeA,IAfA,uBAeA,IAfA;AAAA,QAeA,IAfA,uBAeA,IAfA;;AAgBA,SAAA,IAAA,CAAA,MAAA,CAAA,IAAA,EAAA,IAAA;AACA,GA1CA;AA2CA,EAAA,aA3CA,2BA2CA;AACA,QAAA,KAAA,IAAA,EAAA;AACA,WAAA,IAAA,CAAA,OAAA;AACA;;AACA,IAAA,MAAA,CAAA,mBAAA,CAAA,QAAA,EAAA,KAAA,YAAA,EAJA,CAIA;AACA,GAhDA;AAiDA,EAAA,OAAA,EAAA;AACA,IAAA,UADA,wBACA;AACA,UAAA,KAAA,kBAAA,KAAA,KAAA,2CAAA,KAAA,SAAA,4BAAA,KAAA,GAAA,CAAA;AACA,WAAA,OAAA,GAAA,IAAA,SAAA,CAAA,KAAA,CAAA;AACA,WAAA,OAAA,CAAA,SAAA,GAAA,KAAA,kBAAA;AACA,WAAA,OAAA,CAAA,MAAA,GAAA,KAAA,eAAA;AACA,WAAA,OAAA,CAAA,OAAA,GAAA,KAAA,gBAAA;AACA,WAAA,OAAA,CAAA,OAAA,GAAA,KAAA,cAAA;AACA,KARA;AASA,IAAA,eATA,6BASA,CAAA;AACA,KAVA;AAWA,IAAA,kBAXA,8BAWA,CAXA,EAWA;AAAA;AACA,WAAA,IAAA,CAAA,KAAA,CAAA,CAAA,CAAA,IAAA;AACA,KAbA;AAcA,IAAA,cAdA,0BAcA,CAdA,EAcA;AAAA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,MAAA,EAAA,CAAA;AACA,WAAA,MAAA,CAAA,KAAA;AACA,KAjBA;AAkBA,IAAA,gBAlBA,8BAkBA;AAAA;AACA,WAAA,IAAA,CAAA,KAAA,CAAA,UAAA,EADA,CAEA;AACA,KArBA;AAsBA,IAAA,MAtBA,oBAsBA;AACA,WAAA,IAAA,CAAA,GAAA;AACA,WAAA,MAAA,CAAA,IAAA,CAAA,aAAA,IAAA,CAAA,IAAA,GAAA,UAAA,GAAA,IAAA,CAAA,IAAA,GAAA,GAAA;AACA,KAzBA;AA0BA,IAAA,aA1BA,2BA0BA;AACA,UAAA,SAAA,GAAA,CAAA;AACA,UAAA,UAAA,GAAA,EAAA;AAEA,UAAA,YAAA,GAAA,QAAA,CAAA,IAAA,CAAA,WAAA;AACA,UAAA,aAAA,GAAA,QAAA,CAAA,eAAA,CAAA,YAAA;AACA,aAAA;AACA,QAAA,IAAA,EAAA,IAAA,CAAA,KAAA,CAAA,YAAA,GAAA,SAAA,CADA;AAEA,QAAA,IAAA,EAAA,IAAA,CAAA,KAAA,CAAA,aAAA,GAAA,UAAA;AAFA,OAAA;AAIA,KApCA;AAqCA,IAAA,YArCA,0BAqCA;AAAA;;AACA,UAAA,KAAA,KAAA,EAAA;AACA,QAAA,YAAA,CAAA,KAAA,KAAA,CAAA;AACA,aAAA,KAAA,GAAA,IAAA;AACA;;AACA,WAAA,KAAA,GAAA,UAAA,CAAA,YAAA;AACA,QAAA,KAAA,CAAA,WAAA;AACA,OAFA,EAEA,IAFA,CAAA;AAGA,KA7CA;AA8CA,IAAA,WA9CA,yBA8CA;AAAA,iCACA,KAAA,aAAA,EADA;AAAA,UACA,IADA,wBACA,IADA;AAAA,UACA,IADA,wBACA,IADA;;AAEA,WAAA,IAAA,CAAA,MAAA,CAAA,IAAA,EAAA,IAAA;AACA,WAAA,OAAA,CAAA,IAAA,CAAA,KAAA,aAAA,EAAA;AACA;AAlDA;AAjDA,CAAA","sourcesContent":["\n<template>\n  <div>\n    <div :id=\"terminalId\"/>\n  </div>\n</template>\n \n<script>\nimport { Terminal } from 'xterm'\nimport 'xterm/dist/xterm.css'\nimport * as fit from 'xterm/lib/addons/fit/fit'\nTerminal.applyAddon(fit);\n// 这俩插件不知道干嘛的, 用总比不用好\n//Terminal.applyAddon(winptyCompat)\n//Terminal.applyAddon(webLinks)\n\n\texport default {\n\t\tname: \"pod\",\n\t\tdata() {\n    \treturn {\n      term: null,\n      websock: null,\n      timer: null\n    \t}\n  \t},\n\t\tcomputed: {\n\t\tterminalId() {\n      return `terminal_${this._uid}`\n    \t},\n    namespace() {\n      return localStorage.getItem('namespace')\n    \t},\n    pod() {\n      return localStorage.getItem('pod')\n    \t},\n\t\twsUrl() {\n\t\t\t//const protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://'\n\t\t\tconst host = window.location.host\n\t\t\treturn `${host}`\n\t\t\t}\n\t\t},\n\t\t  mounted() {\n\t\t\twindow.addEventListener('resize', this.handleResize)\n\t\t\t\tthis.initWebSocket()\n\t\t\t\tconst _self = this\n\t\t\t\tthis.term = new Terminal()\n\n\t\t\t\tthis.term.on('data', function(data) {\n\t\t\t\t\tconst sendData = JSON.stringify({ op: 0, stdin: data })\n\t\t\t\t\t_self.websocketsend(sendData)\n\t\t\t\t})\n\n\t\t\t\tthis.term.open(document.getElementById(this.terminalId))\n\n\t\t\t\tthis.term.on('resize', function(size) {\n\t\t\t\t})\n\t\t\t\tconst { cols, rows } = this.get_term_size()\n\t\t\t\tthis.term.resize(cols, rows)\n\t\t\t},\n\t\t\tbeforeDestroy() {\n\t\t\t\tif (this.term) {\n\t\t\t\t\tthis.term.destroy()\n\t\t\t\t}\n\t\t\t\twindow.removeEventListener('resize', this.handleResize) // 移除获取高度事件\n\t\t\t},\n\t\tmethods: {\n\t\t\tinitsocket(){\n\t\t\t\tconst  wsUri = `ws://${this.wsUrl}/api/ws?\" + \"namespace=\" + ${this.namespace} + \"&pod=\" + ${this.pod}`\n\t\t\t\tthis.websock = new WebSocket(wsUri)\n\t\t\t\tthis.websock.onmessage = this.websocketonmessage\n\t\t\t\tthis.websock.onopen = this.websocketonopen\n\t\t\t\tthis.websock.onerror = this.websocketonerror\n\t\t\t\tthis.websock.onclose = this.websocketclose\n\t\t\t\t},\n\t\t\twebsocketonopen() { // 连接建立之后执行send方法发送数据\n\t\t\t},\n\t\t\twebsocketonmessage(e) { // 数据接收\n\t\t\t\tthis.term.write(e.data)\n\t\t\t},\n\t\t\twebsocketclose(e) { // 关闭\n\t\t\t\tconsole.log('断开连接', e)\n\t\t\t\tthis.socket.close()\n\t\t\t},\n\t\t\twebsocketonerror() { // 连接建立失败重连\n\t\t\t\tthis.term.write('连接出错\\r\\n')\n\t\t\t\t// this.initWebSocket()\n\t\t\t},\n\t\t\tresize() {\n\t\t\t\t\tthis.term.fit()\n\t\t\t\t\tthis.socket.send('{\"cols\":' + term.cols + ',\"rows\":' + term.rows + '}')\n\t\t\t},\n\t\t\t\t\tget_term_size() {\n\t\t\t\tvar initWidth = 9\n\t\t\t\tvar initHeight = 17\n\n\t\t\t\tvar windowsWidth = document.body.clientWidth\n\t\t\t\tvar windowsHeight = document.documentElement.clientHeight\n\t\t\t\treturn {\n\t\t\t\t\tcols: Math.floor(windowsWidth / initWidth),\n\t\t\t\t\trows: Math.floor(windowsHeight / initHeight)\n\t\t\t\t}\n\t\t\t},\n\t\t\thandleResize() {\n\t\t\t\tif (this.timer) {\n\t\t\t\t\tclearTimeout(this.timer)\n\t\t\t\t\tthis.timer = null\n\t\t\t\t}\n\t\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\t\tthis.setTermSize()\n\t\t\t\t}, 2000)\n\t\t\t},\n\t\t\tsetTermSize() {\n\t\t\t\tconst { cols, rows } = this.get_term_size()\n\t\t\t\tthis.term.resize(cols, rows)\n\t\t\t\tthis.websock.send(this.get_term_size())\n\t\t\t}\n\t}\n}\n</script>\n\n<style scoped>\n \n \n</style>\n"],"sourceRoot":"src/views"}]}